<!DOCTYPE html>
<html lang="en">
<head>
    <title>Public Accounts of Canada - Data Browser</title>

    <meta charset="UTF-8">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/dc.css"/>
	<link rel="stylesheet" type="text/css" href="css/jquery.gridster.css">
    <link rel="stylesheet" type="text/css" href="css/style.gridster.css">
    
    <link href='highlighter/shCore.css' rel='stylesheet' type='text/css'/>
    <link href='highlighter/shThemeDefault.css' rel='stylesheet' type='text/css'/>
</head>
<body>

<script type="text/javascript" src="js/d3.js"></script>
<script type="text/javascript" src="js/crossfilter.js"></script>
<script type="text/javascript" src="js/dc.js"></script>
<script src="js/jquery-1.7.2.min.js" type="text/javascript"></script>
<script src="js/jquery.gridster.js" type="text/javascript" charset="utf-8"></script>


<script src='highlighter/shCore.js' type='text/javascript'></script>
<script src="highlighter/shAutoloader.js" type="text/javascript"></script>
<script src='highlighter/shBrushJScript.js' type='text/javascript'></script>
<script src='highlighter/shBrushXml.js' type='text/javascript'></script>


<div class="container">

<!--<h1>dc.js - Dimensional Charting Javascript Library v<span id="version"></span></h1>-->

<!--<h2>Authorities and Actual Expenditures as per the Public Accounts of Canada (2009-10 to 2011-12)</h2>-->
<h2>testing...</h2>

 <section class="demo">
 	<div class="row">
	    <div>
	        <div class="dc-data-count">
	            <span class="filter-count"></span> selected out of <span class="total-count"></span> records | <a
	                href="javascript:dc.filterAll(); dc.renderAll();">Reset All</a>
	        </div>
	    </div>
    </div>
	<div class="gridster ready">
          <ul>
            <li data-row="1" data-col="1" data-sizex="1" data-sizey="4">
			    <div id="org-chart">
			        <strong>Government organization</strong>
			        <a class="reset" href="javascript:orgChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
			        <div class="clearfix"></div>
			    </div>            	
            </li>
            <li data-row="1" data-col="2" data-sizex="1" data-sizey="1">
	            <div id="spent0910">
			        <strong>$ Spent 2009-2010</strong>
			        <a class="reset" href="javascript:filterChart0910s.filterAll();dc.redrawAll();" style="display: none;">reset</a>
			        <div class="clearfix"></div>
			    </div>
            </li>
            <li data-row="1" data-col="3" data-sizex="1" data-sizey="1">
				<div id="avail0910">
			        <strong>$ Available 2009-2010</strong>
			        <a class="reset" href="javascript:filterChart0910a.filterAll();dc.redrawAll();" style="display: none;">reset</a>
			        <div class="clearfix"></div>
			    </div>
            </li>
            <li data-row="2" data-col="2" data-sizex="1" data-sizey="1">
				<div id="spent1011">
				        <strong>$ Spent 2010-2011</strong>
				        <a class="reset" href="javascript:filterChart1011s.filterAll();dc.redrawAll();" style="display: none;">reset</a>
				        <div class="clearfix"></div>
				</div>            	            	
            </li>
            <li data-row="2" data-col="3" data-sizex="1" data-sizey="1">
				<div id="avail1011">
			        <strong>$ Available 2010-2011</strong>
			        <a class="reset" href="javascript:filterChart1011a.filterAll();dc.redrawAll();" style="display: none;">reset</a>
			        <div class="clearfix"></div>
			    </div>            	
            </li>
			<li data-row="3" data-col="2" data-sizex="1" data-sizey="1">
				<div id="spent1112">
			        <strong>$ Spent 2011-2012</strong>
			        <a class="reset" href="javascript:filterChart1112s.filterAll();dc.redrawAll();" style="display: none;">reset</a>
			        <div class="clearfix"></div>
			    </div>            	
            </li>
            <li data-row="3" data-col="3" data-sizex="1" data-sizey="1">
			 	<div id="avail1112">
			        <strong>$ Available 2011-2012</strong>
			        <a class="reset" href="javascript:filterChart1112a.filterAll();dc.redrawAll();" style="display: none;">reset</a>
			        <div class="clearfix"></div>
			    </div>           	
            </li>
            <li data-row="4" data-col="2" data-sizex="2" data-sizey="3">
            	<table class="table table-hover dc-data-table">
			        <thead>
			        <tr class="header">
			        		<th>Organizations</th>	
			        		<th>Description</th>
			        		<th>Vote</th>
			        		<th>$ Available 2009-10</th>	
			        		<th>$ Spent 2009-10</th>	
			        		<th>$ Available 2010-11</th>	
			        		<th>$ Spent 2010-11</th>	
			        		<th>$ Available 2011-12</th>	
			        		<th>$ Spent 2011-12</th> 
			        </tr>
			        </thead>
			    </table>
            </li>


          </ul>
    </div>
</section>

<script type="text/javascript">
/*var gainOrLossChart = dc.pieChart("#gain-loss-chart");
var fluctuationChart = dc.barChart("#fluctuation-chart");
var quarterChart = dc.pieChart("#quarter-chart");
var dayOfWeekChart = dc.rowChart("#day-of-week-chart");
var moveChart = dc.compositeChart("#monthly-move-chart");
var volumeChart = dc.barChart("#monthly-volume-chart");
var yearlyBubbleChart = dc.bubbleChart("#yearly-bubble-chart");*/

var orgChart = dc.rowChart("#org-chart");
var filterChart0910a = dc.barChart("#avail0910");
var filterChart1011a = dc.barChart("#avail1011");
var filterChart1112a = dc.barChart("#avail1112");
var filterChart0910s = dc.barChart("#spent0910");
var filterChart1011s = dc.barChart("#spent1011");
var filterChart1112s = dc.barChart("#spent1112");

// set dc.js version in title
d3.selectAll("#version").text(dc.version);

// load data from a csv file
d3.csv("csv/byvote.csv", function (data) {
            // since its a csv file we need to format the data a bit
            //var dateFormat = d3.time.format("%m/%d/%Y");
            var numberFormat = d3.format("d"); 
			var numberFormat2 = d3.format("s"); 
			var numberFormat3 = d3.format(",d"); 
			
            data.forEach(function (e, i) {
            	e.index = i;
            	e.Available_2009_10 = numberFormat(e.Available_2009_10);
            	e.Available_2010_11 = numberFormat(e.Available_2010_11);
            	e.Available_2011_12 = numberFormat(e.Available_2011_12);
            	e.Spent_2009_10 = numberFormat(e.Spent_2009_10);
            	e.Spent_2010_11 = numberFormat(e.Spent_2010_11);
            	e.Spent_2011_12 = numberFormat(e.Spent_2011_12);
            	//e.dd = dateFormat.parse(e.date);
                //e.month = d3.time.month(e.dd); // pre-calculate month for better performance
            });

            // feed it through crossfilter
            var ndx = crossfilter(data);
            var all = ndx.groupAll();
			
			var a0910dim = ndx.dimension(function (d) {
				return Math.log(d.Available_2009_10) / Math.LN10;
            });
            var a0910grp = a0910dim.group(function(v) { 
            	return Math.floor(v); 
            });
      		
      		var s0910dim = ndx.dimension(function (d) {
                return Math.log(d.Spent_2009_10) / Math.LN10;
            });
            var s0910grp = s0910dim.group(function(v) { 
            	return Math.floor(v); 
            });
      		
			var a1011dim = ndx.dimension(function (d) {
                return Math.log(d.Available_2010_11) / Math.LN10;
            });
            var a1011grp = a1011dim.group(function(v) { 
            		return Math.floor(v); 
            });
      		
      		var s1011dim = ndx.dimension(function (d) {
                return Math.log(d.Spent_2010_11) / Math.LN10;
            });
            var s1011grp = s1011dim.group(function(v) { 
            	return Math.floor(v); 
            });
      		
            var a1112dim = ndx.dimension(function (d) {
                return Math.log(d.Available_2011_12) / Math.LN10;
            });
            var a1112grp = a1112dim.group(function(v) { 
            	return Math.floor(v); 
            });
      		
      		var s1112dim = ndx.dimension(function (d) {
                return Math.log(d.Spent_2011_12) / Math.LN10;
            });
            var s1112grp = s1112dim.group(function(v) { 
            	return Math.floor(v); 
            });
      		
      		var organization_dim = ndx.dimension(function (d) {
                return d.Organizations;
            });
            var organization_grp = organization_dim.group();
      		
      		var description_dim = ndx.dimension(function (d) {
                return d.Description;
            });
      		var vote_dim = ndx.dimension(function (d) {
                return d.Vote;
            });
      		
      		orgChart.width(280) // (optional) define chart width, :default = 200
			    .height(1480) // (optional) define chart height, :default = 200
			    .dimension(organization_dim) // set dimension
			    .group(organization_grp) // set group
			    .margins({top: 20, left: 10, right: 10, bottom: 20})
			    //.colors(['#3182bd', '#6baed6', '#9ecae1', '#c6dbef', '#dadaeb'])
			    //.title(function(d) { return d.data.key + "(" + Math.floor(d.data.value / all.value() * 100) + "%)"; })
			    .renderTitle(true)
			    .xAxis().ticks(4);
			      		
			 //Available_2009_10	Spent_2009_10	Available_2010_11	Spent_2010_11	Available_2011_12	Spent_2011_12
			 //min -2702M	-2702M	-3072M	-3072M	-3219M	-3219M
			 //max 27003M	27003M	27863M	27863M	28868M	28868M
			 filterChart0910a.width(300)
                    .height(180)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(a0910dim)
                    .group(a0910grp)
                    .elasticY(true)
                    .centerBar(true)
                    .gap(3)
                    .round(dc.round.floor)
                    .x(d3.scale.linear().domain([1,11])) //domain([d3.min(data, function(d) { return d.s0910dim; }),d3.max(data, function(d) { return d.s0910dim; })])) //domain([-3000000000, 30000000000]))
                    .renderHorizontalGridLines(true)
                    .xAxis()
                    .tickFormat(function (v) {
                        return numberFormat2(Math.pow(10,v));
                    });
             filterChart0910s.width(300)
                    .height(180)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(s0910dim)
                    .group(s0910grp)
                    .elasticY(true)
                    .centerBar(true)
                    .gap(3)
                    .round(dc.round.floor)
                    .x(d3.scale.linear().domain([1,11])) //domain([d3.min(data, function(d) { return d.s0910dim; }),d3.max(data, function(d) { return d.s0910dim; })])) //domain([-3000000000, 30000000000]))
                    .renderHorizontalGridLines(true)
                    .xAxis()
                    //.tickValues(['1','10','100','1t','10t','100t','1M','10M','100M','1B','10B',]);
                    .tickFormat(function (v) {
                        return numberFormat2(Math.pow(10,v));
                        //return Math.round(v);
                    });
                      
              filterChart1011a.width(300)
                    .height(180)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(a1011dim)
                    .group(a1011grp)
                    .elasticY(true)
                    .centerBar(true)
                    .gap(3)
                    .round(dc.round.floor)
                    .x(d3.scale.linear().domain([1,11])) //domain([d3.min(data, function(d) { return d.s0910dim; }),d3.max(data, function(d) { return d.s0910dim; })])) //domain([-3000000000, 30000000000]))
                    .renderHorizontalGridLines(true)
                    .xAxis()
                    .tickFormat(function (v) {
                        return numberFormat2(Math.pow(10,v));                        
                    });
             filterChart1011s.width(300)
                    .height(180)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(s1011dim)
                    .group(s1011grp)
                    .elasticY(true)
                    .centerBar(true)
                    .gap(3)
                    .round(dc.round.floor)
                    .x(d3.scale.linear().domain([1,11])) //domain([d3.min(data, function(d) { return d.s0910dim; }),d3.max(data, function(d) { return d.s0910dim; })])) //domain([-3000000000, 30000000000]))
                    .renderHorizontalGridLines(true)
                    .xAxis()
                    .tickFormat(function (v) {
                        return numberFormat2(Math.pow(10,v));
                    });    
             filterChart1112a.width(300)
                    .height(180)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(a1112dim)
                    .group(a1112grp)
                    .elasticY(true)
                    .centerBar(true)
                    .gap(3)
                    .round(dc.round.floor)
                    .x(d3.scale.linear().domain([1,11])) //domain([d3.min(data, function(d) { return d.s0910dim; }),d3.max(data, function(d) { return d.s0910dim; })])) //domain([-3000000000, 30000000000]))
                    .renderHorizontalGridLines(true)
                    .xAxis()
                    .tickFormat(function (v) {
                        return numberFormat2(Math.pow(10,v));
                    });
             filterChart1112s.width(300)
                    .height(180)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(s1112dim)
                    .group(s1112grp)
                    .elasticY(true)
                    .centerBar(true)
                    .gap(3)
                    .round(dc.round.floor)
                    .x(d3.scale.linear().domain([1,11])) //domain([d3.min(data, function(d) { return d.s0910dim; }),d3.max(data, function(d) { return d.s0910dim; })])) //domain([-3000000000, 30000000000]))
                    .renderHorizontalGridLines(true)
                    .xAxis()
                    .tickFormat(function (v) {
                        return numberFormat2(Math.pow(10,v));
                    });        
            
            dc.dataCount(".dc-data-count")
                    .dimension(ndx)
                    .group(all);

            dc.dataTable(".dc-data-table")
                    .dimension(description_dim)
                    .group(function (d) {
                        return d.Organizations;
                        //var format = d3.format(" ,d"); //02d
                        //return d.dd.getFullYear() + "/" + format((d.dd.getMonth() + 1));
                    })
                    .size(600)
                    .columns([
                    	function (d) {
                            return d.Organizations;
                        },
                        function (d) {
                            return d.Description;
                        },
                        function (d) {
                            return d.Vote;
                        },
                        function (d) {
                            return numberFormat3(d.Available_2009_10);
                        },
                        function (d) {
                            return numberFormat3(d.Spent_2009_10);
                        },
                        function (d) {
                            return numberFormat3(d.Available_2010_11);
                        },
                        function (d) {
                            return numberFormat3(d.Spent_2010_11);
                        },
                        function (d) {
                            return numberFormat3(d.Available_2011_12);
                        },
                        function (d) {
                            return numberFormat3(d.Spent_2011_12);
                        }	
                    ])
                    .sortBy(function (d) {
                        return d.Organizations;
                    })
                    .order(d3.ascending)
                    .renderlet(function (table) {
                        table.selectAll(".dc-table-group").classed("info", true);
                    });

            dc.renderAll();
            }
		);
		
		var gridster;

		  $(function(){
		    gridster = $(".gridster > ul").gridster({
		        widget_margins: [2, 2],
		        widget_base_dimensions: [320, 200],
		        min_cols: 4
		    }).data('gridster');
		
		  });
</script>

<!--<script src="http://code.jquery.com/jquery-latest.js"></script>-->
<script src="js/bootstrap.min.js"></script>

<script type="text/javascript">
    SyntaxHighlighter.all();
</script>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'GOOGLEANALYTICS']);
    _gaq.push(['_trackPageview']);

    (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
    })();
</script>

</body>
</html>
